<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Coventry Roleplay — Suggestions</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <nav class="nav" aria-label="Primary">
      <a class="brand" href="index.html" aria-label="Coventry Roleplay Home">
        <img src="CV.png" alt="Police Service Logo" class="nav-logo" />
        <span>Coventry Roleplay</span>
      </a>
      <button class="menu-toggle" aria-expanded="false" aria-controls="site-links">Menu</button>
      <div id="site-links" class="links" role="menubar">
        <a role="menuitem" href="index.html">Home</a>
        <a role="menuitem" href="leadership.html">Leadership</a>
        <a role="menuitem" href="services.html">Services</a>
        <a role="menuitem" href="contact.html">Contact</a>
        <a role="menuitem" class="active" href="suggestions.html">Suggestions</a>
      </div>
    </nav>
  </header>

  <section class="hero small">
    <div class="hero-inner">
      <h1 class="title reveal"><span class="grad">Suggestions</span></h1>
      <p class="subtitle reveal">Got an idea? Submit your suggestions to help improve Coventry Roleplay.</p>
    </div>
  </section>

<section class="container">
  <div class="card" style="max-width:600px;margin:auto; padding:20px; background:#1e1e2f; color:#fff; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.3);">
    
    <!-- Privacy Notice -->
    <div style="margin-bottom:15px; background:#2a2a3d; padding:10px; border-radius:8px; font-size:0.9em; color:#ccc;">
      <strong>Privacy Notice:</strong> When you submit a suggestion, we log your IP address along with your submission to help prevent abuse.
      We only use this for security and moderation purposes. Inappropriate suggestions may result in being blocked from future submissions.
      For more information, please see our <a href="privacy.html" style="color:#66b3ff;">Privacy Policy</a>.
    </div>

    <form id="suggestionForm">
      <label for="username" style="display:block; margin-bottom:6px; font-weight:bold;">Roblox Username</label>
      <input type="text" id="username" name="username" placeholder="Your Roblox Username" required 
        style="width:100%; padding:10px; margin-bottom:15px; border:none; border-radius:8px; background:#2a2a3d; color:#fff;" />
      
      <label for="suggestion" style="display:block; margin-bottom:6px; font-weight:bold;">Your Suggestion</label>
      <textarea id="suggestion" name="suggestion" rows="5" placeholder="Enter your suggestion here..." required 
        style="width:100%; padding:10px; margin-bottom:15px; border:none; border-radius:8px; background:#2a2a3d; color:#fff;"></textarea>
      
      <!-- Consent checkbox -->
      <label style="display:block; margin-bottom:15px; font-size:0.9em;">
        <input type="checkbox" id="consentCheckbox" /> I agree to the privacy notice and consent to my IP being logged for moderation purposes.
      </label>

      <button type="submit" id="submitBtn" class="btn primary" disabled
        style="padding:12px 20px; width:100%; border:none; border-radius:8px; font-weight:bold;
               background:linear-gradient(90deg,#007bff,#6610f2); color:white; cursor:pointer;">
        Submit Suggestion
      </button>
    </form>
  </div>
</section>

  <footer>
    <div class="footer-inner">
      <div class="brand" aria-hidden="true">
        <span class="logo"></span>
        <span>Coventry Roleplay</span>
      </div>
      <div class="tiny">© <span id="year"></span> Coventry Roleplay • Unofficial fan content, not endorsed by Roblox.</div>
    </div>
  </footer>

  <script>
    // Enable submit only if consent is checked
    const consentCheckbox = document.getElementById("consentCheckbox");
    const submitBtn = document.getElementById("submitBtn");
    consentCheckbox.addEventListener("change", function() {
      submitBtn.disabled = !this.checked;
    });

    // Handle form submission with JSON payload
    document.getElementById("suggestionForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      if (!consentCheckbox.checked) {
        alert("You must agree to the privacy notice to submit a suggestion.");
        return;
      }
      const form = e.target;

      const payload = {
        username: form.username.value,
        suggestion: form.suggestion.value
      };

      try {
        const res = await fetch("https://9ad39be4-cdef-47ab-acfe-32b52712ad73-00-3t3dvnup6jz45.kirk.replit.dev/suggest", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const result = await res.json();

        if (res.ok && result.success) {
          alert("✅ Suggestion submitted successfully!");
          form.reset();
          submitBtn.disabled = true; // reset consent checkbox too
          consentCheckbox.checked = false;
        } else {
          alert("❌ Failed to submit suggestion: " + (result.error || "Unknown error"));
        }
      } catch (err) {
        console.error(err);
        alert("⚠️ Error sending suggestion.");
      }
    });

    // Set the current year in the footer
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>
</body>
</html>
